# config/config.yaml
# Configuration for Vessel Tracing RL System

# Data settings
data:
  datasets:
    - name: "DRIVE"
      path: "data/DRIVE"
      split: "train"
    - name: "STARE"
      path: "data/STARE"
      split: "test"
  tile_size: 512
  overlap: 64
  augmentation:
    brightness_range: [0.8, 1.2]
    contrast_range: [0.8, 1.2]
    rotation_range: [-15, 15]
    elastic_alpha: 50
    elastic_sigma: 5
    noise_std: 0.02

# Environment settings
environment:
  observation_size: 65  # Local crop size
  step_size: 1
  tolerance: 2  # pixels
  max_off_track_streak: 5
  max_steps_per_episode: 2000

# Reward settings
reward:
  alpha_near: 1.0      # Proximity reward weight
  beta_coverage: 2.0   # Coverage bonus
  gamma_off: -1.0      # Off-track penalty
  lambda_revisit: -0.5 # Revisit penalty
  step_cost: -0.01     # Per-step cost
  direction_bonus: 0.1 # Smoothness bonus
  terminal_f1_weight: 10.0
  use_potential_shaping: true

# Policy network settings
policy:
  encoder_type: "cnn"  # "cnn" or "resnet"
  hidden_dim: 256
  lstm_hidden: 128
  use_lstm: true
  dropout: 0.1

# Seed detector settings
seed_detector:
  backbone: "resnet18"
  pretrained: true
  nms_radius: 10
  confidence_threshold: 0.5
  top_k_seeds: 50

# Training settings
training:
  # Imitation learning
  imitation:
    epochs: 50
    batch_size: 256
    learning_rate: 0.001
    
  # PPO settings
  ppo:
    learning_rate: 0.0003
    gamma: 0.99
    gae_lambda: 0.95
    clip_epsilon: 0.2
    value_loss_coef: 0.5
    entropy_coef: 0.01
    max_grad_norm: 0.5
    num_epochs: 10
    batch_size: 64
    num_envs: 8
    rollout_length: 256
    total_timesteps: 5_000_000
    
  # Curriculum settings
  curriculum:
    start_difficulty: 0.2
    end_difficulty: 1.0
    warmup_steps: 500_000

# Evaluation settings
evaluation:
  tolerance_levels: [1, 2, 3]
  metrics:
    - "f1_score"
    - "precision"
    - "recall"
    - "cldice"
    - "connected_components"
    - "betti_numbers"

# Logging
logging:
  use_wandb: true
  project_name: "vessel-tracing"
  log_interval: 100
  eval_interval: 5000
  checkpoint_interval: 10000
